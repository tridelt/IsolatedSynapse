using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PuzzleVulnerabilityManager : MonoBehaviour
{
    public AudioClip trap;
    AudioSource audio;

    public Transform bottom_blockade;

    private bool top_left = false;
    private bool top_right = false;
    private bool bottom_left = false;
    private bool bottom_right = false;

    private bool wheel1_active = false;

    [SerializeField] GameObject[] SpecialEnemies;

    void Awake()
    {
        Rune[] stateModifiers = FindObjectsOfType<Rune>();
        foreach (Rune stateModifier in stateModifiers)
        {
            stateModifier.onStateChanged.AddListener(() => OnObjectStateChanged(stateModifier));
        }
    }

    void Start()
    {
        audio = GetComponent<AudioSource>();
    }

    public void OnObjectStateChanged(Rune rune)
    {
        if (rune.runeIsActive)
        {
            if (rune.name == "top_left_rune")
            {
                top_left = true;
            }
            else if (rune.name == "top_right_rune")
            {
                top_right = true;
            }
            else if (rune.name == "bottom_left_rune")
            {
                bottom_left = true;
            }
            else if (rune.name == "bottom_right_rune")
            {
                bottom_right = true;
            }
        }

        // If the correct combination of states has been achieved, open the door
        if (top_left && top_right && bottom_left && bottom_right)
        {
            audio.clip = trap;
            audio.Play();
            bottom_blockade.gameObject.SetActive(false);
            foreach(GameObject SpecialEnemy in SpecialEnemies)
            {
                SpecialEnemy.GetComponent<SpecialEnemy>().Weakened();
            }
        }
    }
}
